<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">
	
	<resultMap type="shop.zeedeco.util.CamelCaseMap" id="camelCaseMap"></resultMap>
	
	<sql id="getSql">
		SELECT 
			board_seq
			, type_cd
			, lang_cd
			, title
			, content
			, remark
			, period_start_dt
			, period_end_dt
			, comment_yn
			, attachment_yn
			, use_yn
			, del_yn
			, created_dt
			, created_no
			, updated_dt
			, updated_no
		FROM board
		WHERE 1=1
	</sql>
	
	<sql id="getWhere">
		<if test="boardSeq != null and !boardSeq.equals('')">
			AND board_seq= #{boardSeq}
		</if>	
		<if test="commentYn != null and !commentYn.equals('')">
			AND comment_yn= #{commentYn}
		</if>
		<if test="attachmentYn != null and !attachmentYn.equals('')">
			AND attachment_yn= #{attachmentYn}
		</if>					
		<if test="search != null">
			<if test="search.typeCd != null and !search.typeCd.equals('')">
				AND type_cd= #{search.typeCd}
			</if>
			<if test="search.langCd != null and !search.langCd.equals('')">
				AND lang_cd= #{search.langCd}
			</if>
			<if test="search.memberSeq != null and !search.memberSeq.equals('')">
				AND created_no= #{search.memberSeq}
			</if>
			<if test="search.content != null and !search.content.equals('')">
				AND content like CONCAT('%', #{search.content}, '%')
			</if>
			<if test="search.remark != null and !search.remark.equals('')">
				AND remark like CONCAT('%', #{search.remark}, '%')
			</if>			
			<if test="search.keyword != null and !search.keyword.equals('')">
				AND title like CONCAT('%', #{search.keyword}, '%')
				OR content like CONCAT('%', #{search.keyword}, '%')
				OR remark like CONCAT('%', #{search.keyword}, '%')
			</if>
			<if test="(search.periodStartedStartDt != null and !search.periodStartedStartDt.equals('')) and (search.periodEndedStartDt == null or search.periodEndedStartDt.equals(''))">
				AND DATE_FORMAT(period_start_dt, '%Y-%m-%d %H:%i:%s') <![CDATA[ >= ]]> #{search.periodStartedStartDt}
			</if>
			<if test="(search.periodStartedStartDt == null or search.periodStartedStartDt.equals('')) and (search.periodEndedStartDtt != null and !search.periodEndedStartDt.equals(''))">
				AND DATE_FORMAT(period_start_dt, '%Y-%m-%d %H:%i:%s') <![CDATA[ <= ]]> #{search.periodEndedStartDt}
			</if>
			<if test="(search.periodStartedStartDt != null and !search.periodStartedStartDt.equals('')) and (search.periodEndedStartDt != null and !search.periodEndedStartDt.equals(''))">
				AND DATE_FORMAT(period_start_dt, '%Y-%m-%d %H:%i:%s') BETWEEN #{search.periodStartedStartDt} AND #{search.periodEndedStartDt}
			</if>
			<if test="(search.periodStartedEndDt != null and !search.periodStartedEndDt.equals('')) and (search.periodEndedEndDt == null or search.periodEndedEndDt.equals(''))">
				AND DATE_FORMAT(period_end_dt, '%Y-%m-%d %H:%i:%s') <![CDATA[ >= ]]> #{search.periodStartedEndDt}
			</if>
			<if test="(search.periodStartedEndDt == null or search.periodStartedEndDt.equals('')) and (search.periodEndedEndDt != null and !search.periodEndedEndDt.equals(''))">
				AND DATE_FORMAT(period_end_dt, '%Y-%m-%d %H:%i:%s') <![CDATA[ <= ]]> #{search.periodEndedEndDt}
			</if>
			<if test="(search.periodStartedEndDt != null and !search.periodStartedEndDt.equals('')) and (search.periodEndedEndDt != null and !search.periodEndedEndDt.equals(''))">
				AND DATE_FORMAT(period_end_dt, '%Y-%m-%d %H:%i:%s') BETWEEN #{search.periodStartedEndDt} AND #{search.periodEndedEndDt}
			</if>
			<if test="(search.createdStartDt != null and !search.createdStartDt.equals('')) and (search.createdEndDt == null or search.createdEndDt.equals(''))">
				AND DATE_FORMAT(created_dt, '%Y-%m-%d %H:%i:%s') <![CDATA[ >= ]]> #{search.createdStartDt}
			</if>
			<if test="(search.createdStartDt == null or search.createdStartDt.equals('')) and (search.createdEndDt != null and !search.createdEndDt.equals(''))">
				AND DATE_FORMAT(created_dt, '%Y-%m-%d %H:%i:%s') <![CDATA[ <= ]]> #{search.createdEndDt}
			</if>
			<if test="(search.createdStartDt != null and !search.createdStartDt.equals('')) and (search.createdEndDt != null and !search.createdEndDt.equals(''))">
				AND DATE_FORMAT(created_dt, '%Y-%m-%d %H:%i:%s') BETWEEN #{search.createdStartDt} AND #{search.createdEndDt}
			</if>
			<if test="(search.updatedStartDt != null and !search.updatedStartDt.equals('')) and (search.updatedEndDt == null or search.updatedEndDt.equals(''))">
				AND DATE_FORMAT(updated_dt, '%Y-%m-%d %H:%i:%s') <![CDATA[ >= ]]> #{search.updatedStartDt}
			</if>
			<if test="(search.updatedStartDt == null or search.updatedStartDt.equals('')) and (search.updatedEndDt != null and !search.updatedEndDt.equals(''))">
				AND DATE_FORMAT(updated_dt, '%Y-%m-%d %H:%i:%s') <![CDATA[ <= ]]> #{search.updatedEndDt}
			</if>
			<if test="(search.updatedStartDt != null and !search.updatedStartDt.equals('')) and (search.updatedEndDt != null and !search.updatedEndDt.equals(''))">
				AND DATE_FORMAT(updated_dt, '%Y-%m-%d %H:%i:%s') BETWEEN #{search.updatedStartDt} AND #{search.updatedEndDt}
			</if>
			<if test="search.useYn != null and !search.useYn.equals('')">
				AND use_yn= #{search.useYn}
			</if>
			<if test="search.delYn != null and !search.delYn.equals('')">
				AND del_yn= #{search.delYn}
			</if>
		</if>
	</sql>
	
	<select id="getBoards" resultMap="camelCaseMap">
		/** board.getBoards **/
		<include refid="getSql"/>
		<include refid="getWhere"/>
		ORDER BY board_seq desc
		<if test="search != null">
		  	<if test="search.startRow != null and !search.startRow.equals('')">limit #{search.startRow}, #{search.size}</if>
		</if>

	</select>
	
	<select id="getBoardsCnt" resultMap="camelCaseMap">
		/** board.getBoardsCnt **/
		select count(*) as cnt 
		from board where 1=1
		<include refid="getWhere"/>
	</select>
	
	<insert id="addBoard" useGeneratedKeys="true" keyProperty="boardSeq">
		/** board.addBoard **/
		INSERT INTO board (
			type_cd
			, lang_cd
			, title
			, content
			, remark
			, period_start_dt
			, period_end_dt
			, comment_yn
			, attachment_yn
			, use_yn
			, del_yn
			, created_dt
			, created_no
		) VALUES (
			#{handle.typeCd}
			, #{handle.langCd}
			, #{title}
			, #{handle.content}
			, #{handle.remark}
			, #{handle.periodStartDt}
			, #{handle.periodEndDt}
			, #{commentYn}
			, #{attachmentYn}
			, #{handle.useYn}
			, #{handle.delYn}
			, NOW()
			, #{handle.memberSeq}
		)
	</insert>
	
	<update id="setBoard">
		/** board.setBoard **/
		UPDATE board
		<set>
			<if test="title != null and !title.equals('')"> title= #{title},</if>
			<if test="attachmentYn != null and !attachmentYn.equals('')"> attachment_yn= #{attachmentYn},</if>
			<if test="commentYn != null and !commentYn.equals('')"> comment_yn= #{commentYn},</if>
			<if test="handle != null">
				<if test="handle.typeCd != null and !handle.typeCd.equals('')"> type_cd= #{handle.typeCd},</if>
				<if test="handle.langCd != null and !handle.langCd.equals('')"> lang_cd= #{handle.langCd},</if>
				<if test="handle.content != null and !handle.content.equals('')"> content= #{handle.content},</if>
				<if test="handle.remark != null and !handle.remark.equals('')"> remark= #{handle.remark},</if>
				<if test="handle.periodStartDt != null and !handle.periodStartDt.equals('')"> period_start_dt= #{periodStartDt},</if>
				<if test="handle.periodEndDt != null and !handle.periodEndDt.equals('')"> period_end_dt= #{periodEndDt},</if>			
				<if test="handle.useYn != null and !handle.useYn.equals('')"> use_yn= #{handle.useYn},</if>
				<if test="handle.delYn != null and !handle.delYn.equals('')"> del_yn= #{handle.delYn},</if>
				updated_no= #{handle.memberSeq},
			</if>
			updated_dt= NOW()
		</set>
		WHERE board_seq= #{boardSeq}
	</update>
	
	<delete id="removeBoard">
		/** board.removeBoard **/
		DELETE FROM board
		WHERE board_seq= #{boardSeq}
	</delete>
	
</mapper>